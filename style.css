@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

:root {
    /* Default Dark Theme (Refinity Style) */
    --bg-dark: #121212;
    --bg-sidebar: #1E1E1E;
    --card-bg: #252525;
    --card-hover: #2A2A2A;
    --border-color: #333;

    --text-primary: #E0E0E0;
    --text-secondary: #A0A0A0;
    --text-tertiary: #777;

    /* Accents */
    --accent-gold: #C5A065;
    --accent-red: #D64545;
    --accent-purple: #8E44AD;
    --accent-green: #27AE60;

    --sidebar-width: 400px;
    --rail-width: 70px;

    /* Map Overlay Opacity */
    --map-overlay-opacity: 0.8;
}

[data-theme="light"] {
    /* Light Mode Palette */
    --bg-dark: #F5F7FA;
    /* Soft Gray Background for Map Area/Body */
    --bg-sidebar: #F1F2F6;
    /* Soft Gray/White for Sidebar to separate from Map */
    --card-bg: #FFFFFF;
    /* White Cards */
    --card-hover: #F8F9FA;
    /* Very Light Gray Hover */
    --border-color: #E2E8F0;
    /* Light Border */

    --text-primary: #1A202C;
    /* Very Dark Blue/Gray */
    --text-secondary: #4A5568;
    /* Medium Gray */
    --text-tertiary: #718096;
    /* Light Gray */

    /* Accents - Darkened for visibility on white */
    --accent-gold: #B48E55;
    --accent-red: #C53030;
    --accent-purple: #6B46C1;
    --accent-green: #2F855A;
}

body,
html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Inter', sans-serif;
    color: var(--text-primary);
    background-color: var(--bg-dark);
    transition: background-color 0.3s ease, color 0.3s ease;
}

.dashboard-container {
    display: flex;
    height: 100vh;
    height: 100dvh;
    /* Mobile Browser Friendly */
    overflow: hidden;
}

/* Sidebar */
.sidebar {
    width: var(--sidebar-width);
    /* Default open width */
    min-width: 360px;
    /* Limit how small it can be dragged */
    max-width: 50vw;
    background-color: var(--bg-sidebar);
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-color);
    z-index: 1000;
    padding: 20px;
    box-sizing: border-box;
    position: relative;
    /* Transition Max-Width and Min-Width for smooth constraint change, plus padding */
    transition: width 0.3s ease, min-width 0.3s ease, padding 0.3s ease;
    overflow: hidden;
    white-space: nowrap;
    /* Prevent wrapping during shrink */
}

/* Rail Mode */
.sidebar.rail-mode {
    width: var(--rail-width) !important;
    min-width: var(--rail-width) !important;
    padding: 20px 0;
    /* Remove horizontal padding */
}

/* Children Transition Logic */
/* We target specific text/content elements to fade them out */
.sidebar .logo-area h1,
.sidebar .main-nav span:not(.icon),
.sidebar .earthquake-list-container,
.sidebar #lang-toggle,
.sidebar #sidebar-resizer {
    opacity: 1;
    transform: translateX(0);
    transition: opacity 0.2s ease, transform 0.2s ease;
    /* Delay the fade-in slightly so sidebar expands first? No, fade quick. */
}

/* When in rail mode, fade them out */
.sidebar.rail-mode .logo-area h1,
.sidebar.rail-mode .main-nav span:not(.icon),
.sidebar.rail-mode .earthquake-list-container,
.sidebar.rail-mode #lang-toggle,
.sidebar.rail-mode #sidebar-resizer {
    opacity: 0;
    transform: translateX(-10px);
    pointer-events: none;
    /* Ensure they don't block clicks */
    position: absolute;
    /* Remove from flow so width collapses */
    visibility: hidden;
    /* Ensure completely gone after transition */
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s linear 0.2s;
    /* Visibility delay to wait for opacity */
}

/* Ensure list container collapses fully */
.sidebar.rail-mode .earthquake-list-container {
    flex: 0;
    padding: 0;
}

/* Layout adjustments for Rail Mode */
.sidebar.rail-mode .logo-area {
    justify-content: center !important;
    padding-bottom: 20px;
}

.sidebar.rail-mode .main-nav li {
    justify-content: center;
    padding: 15px 0;
}

.sidebar.rail-mode .main-nav .icon {
    font-size: 24px;
    margin: 0;
}

/* Sidebar Resizer */
#sidebar-resizer {
    width: 6px;
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    cursor: col-resize;
    z-index: 1002;
    transition: background-color 0.2s;
}

#sidebar-resizer:hover {
    background-color: var(--accent-gold);
}

/* Logo Area */
.logo-area {
    margin-bottom: 5px;
    /* Reduced from 10px */
    padding-bottom: 10px;
    /* Reduced from 15px */
    border-bottom: 1px solid var(--border-color);
}

.logo-area h1 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
}

.logo-area span {
    color: var(--accent-gold);
}

/* Controls Container (Theme, Lang, Toggle) */
.logo-area .controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Rail Mode Adjustments for Controls */
.sidebar.rail-mode .logo-area .controls {
    flex-direction: column;
    gap: 16px;
    /* Increased gap */
    margin-top: 15px;
    width: 100%;
    align-items: center;
}

/* Specific order for Rail Mode: Toggle first or last?
   User said "daha düzgün yerleştir".
   Let's try: Toggle (Top), Theme (Middle), Lang (Bottom) OR
   Theme, Lang, Toggle (Bottom with spacing).

   Let's add a separator or just spacing.
*/

.sidebar.rail-mode .logo-area {
    flex-direction: column;
    height: auto;
    padding-bottom: 20px;
    padding-top: 10px;
}

.sidebar.rail-mode #sidebar-toggle-btn {
    order: -1;
    /* Move toggle to top of the stack? Or make it distinct */
    width: 40px;
    /* Larger hit area */
    height: 40px;
    border-radius: 8px;
    background: var(--bg-dark);
    /* Contrast */
    border-color: var(--border-color);
}

.sidebar.rail-mode #sidebar-toggle-btn:hover {
    background: var(--accent-gold);
    color: #000;
}

.sidebar.rail-mode .logo-area h1 {
    display: none;
    /* Hide text title explicitely if not already */
}

/* Icon Buttons */
.icon-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    padding: 0;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Ensure specific buttons in header maintain this shape */
.logo-area .icon-btn {
    width: 32px;
    height: 32px;
    padding: 0;
}

.icon-btn:hover {
    border-color: var(--accent-gold);
    color: var(--accent-gold);
    background: rgba(197, 160, 101, 0.1);
}

#refresh-btn {
    width: 28px;
    height: 28px;
    padding: 0;
    font-size: 14px;
    border: none;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    border-radius: 50%;
    /* Circular */
    transition: all 0.3s ease;
}

/* Only apply hover on devices that support it to prevent sticky hover on mobile */
@media (hover: hover) {
    #refresh-btn:hover {
        background: var(--accent-gold);
        color: #000;
        box-shadow: 0 0 10px rgba(197, 160, 101, 0.4);
    }
}

#refresh-btn:active {
    background: var(--accent-gold);
    color: #000;
    transform: scale(0.95);
}

#refresh-btn:focus {
    outline: none;
}

/* Loading Spinner */
.loader-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 0;
    flex: 1;
}

.loader {
    width: 24px;
    height: 24px;
    border: 3px solid var(--card-bg);
    border-bottom-color: var(--accent-gold);
    border-radius: 50%;
    display: inline-block;
    box-sizing: border-box;
    animation: rotation 1s linear infinite;
}

@keyframes rotation {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

/* Navigation */
.main-nav ul {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
}

.main-nav li {
    padding: 8px 10px;
    cursor: pointer;
    border-radius: 8px;
    margin-bottom: 2px;
    transition: all 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 500;
}

.main-nav li:hover {
    background: var(--card-bg);
    color: var(--text-primary);
}

.main-nav li.active {
    background: rgba(197, 160, 101, 0.15);
    /* Low opacity gold */
    color: var(--accent-gold);
}

.main-nav .icon {
    font-size: 18px;
    min-width: 24px;
    height: 24px;
    /* Fixed height matching width */
    display: flex;
    /* Flex to center SVG */
    align-items: center;
    /* Vertical Center */
    justify-content: center;
    /* Horizontal Center */
    margin: 0;
    padding: 0;
}

.main-nav li span:not(.icon) {
    line-height: 1;
    /* Reset line height to avoid offset */
    display: block;
    /* Ensure it treats line-height correctly */
    padding-top: 2px;
    /* Visual adjustment if font baseline is weird */
}

/* Switch Component */
.theme-switch-wrapper {
    display: flex;
    align-items: center;
}

.theme-switch {
    display: inline-block;
    height: 24px;
    position: relative;
    width: 48px;
    box-sizing: border-box;
}

.theme-switch * {
    box-sizing: border-box;
}

.theme-switch input {
    display: none;
}

.slider {
    background-color: #333;
    bottom: 0;
    cursor: pointer;
    left: 0;
    position: absolute;
    right: 0;
    top: 0;
    transition: .4s;
    border-radius: 34px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 5px;
}

.slider:before {
    background-color: #fff;
    bottom: 3px;
    content: "";
    height: 18px;
    left: 3px;
    position: absolute;
    transition: .4s;
    width: 18px;
    border-radius: 50%;
    z-index: 2;
}

/* Icons */
.slider .icon {
    color: #555;
    /* Default dark icon color on light background of the toggle */
    font-size: 12px;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    transition: color 0.3s;
}

.slider .icon svg {
    width: 12px;
    height: 12px;
}

/* Color adjustments based on state */
/* If checked (Dark Mode), the toggle background is darker, icons might need to be lighter or stay dark? */
/* Let's make the active icon (the one not covered by the circle) visible */

/* Actually, the circle moves. 
   - Unchecked (Light Mode): Circle is on Left (Sun). Meaning we see Moon on Right. 
     Wait, standard toggle:
     - Checkbox unchecked = Default. 
     - Checked = Switched.
     Let's assume Unchecked = Light Mode? 
     If initTheme sets it to stored theme...
     My logic in theme.js: checkbox.checked = (theme === 'dark').
     So Checked = Dark.
     
     If Checked (Dark): Circle moves Right (covers Moon). Sun is visible on Left.
     If Unchecked (Light): Circle moves Left (covers Sun). Moon is visible on Right.
     
     Wait, usually toggle shows what you WILL switch to, or the current state?
     Usually:
     - [ O ] -> Button is on left. Background is light. Label says "Light".
     - [ X ] -> Button is on right. Background is dark.
     
     The slider has two icons inside it. 
     <div class="slider"> <Sun> <Moon> </div>
     
     If ::before (circle) is on Left (Unchecked - Light), it covers Sun?
     CSS: .slider:before { left: 3px; ... }
     
     So Unchecked: Circle on Left.
     We want Sun to be ON the circle or Visible?
     Usually icons are background for the toggle track.
     
     If circle is on Left, it covers the Left side content? 
     No, `z-index: 2` on `:before`, `z-index: 1` on `.icon`.
     Yes, it covers the icon if they overlap.
     
     Layout:
     justify-content: space-between; padding: 0 5px;
     
     [ (Sun)  Moon ]  <- Circle covers Sun?
     
     If I want the visible icon to represent the CURRENT mode:
     - Light Mode: We want to see a Sun? Or we see a Moon to switch to Dark?
     
     Let's stick to "Current State Icon is Highlighted" or "Visible Icon is the Target".
     
     Standard MacOS toggle:
     [ Sun (O) ] -> Dark mode active?
     
     Let's just make them colorless (#555 or var(--text-secondary)) and clean.
*/

input:checked+.slider .icon.sun {
    color: #fff;
    /* Visible on dark background */
}

input:checked+.slider .icon.moon {
    color: transparent;
    /* Covered */
}

input:not(:checked)+.slider .icon.sun {
    color: transparent;
    /* Covered */
}

input:not(:checked)+.slider .icon.moon {
    color: #555;
}

/* Adjust colors for Theme */
/* When Dark Mode (Checked): Slider bg is #666. Sun is visible (left). */
/* When Light Mode (Unchecked): Slider bg is #333. Moon is visible (right). */
/* Wait, Unchecked (Light) -> slider bg is #333 defined in CSS? */
/* .slider { background-color: #333; } */
/* [data-theme="light"] .slider { background-color: #ccc; } */

/* So:
   Light Mode (Unchecked): Bg #ccc. Circle Left. Covers Sun?
   We see Moon on Right. Moon color should be #555.
   
   Dark Mode (Checked): Bg #666. Circle Right. Covers Moon.
   We see Sun on Left. Sun color should be #fff or #ddd.
*/

.slider .icon {
    color: var(--text-secondary);
}

/* Specific overrides */
input:checked+.slider .icon.sun {
    color: #eee;
}

input:checked+.slider .icon.moon {
    opacity: 0;
}

input:not(:checked)+.slider .icon.sun {
    opacity: 0;
}

input:not(:checked)+.slider .icon.moon {
    color: #555;
}

input:checked+.slider {
    background-color: #666;
}

input:checked+.slider:before {
    transform: translateX(24px);
}

/* Light Theme overrides for switch */
[data-theme="light"] .slider {
    background-color: #ccc;
}

[data-theme="light"] input:checked+.slider {
    background-color: #2196F3;
}

.earthquake-list-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    opacity: 1;
    transition: opacity 0.2s;
}

.view-section {
    display: flex;
    flex-direction: column;
    flex: 1;
    height: 100%;
    overflow: hidden;
}

.list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 0 5px;
}

.list-header h3 {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin: 0;
}

.badge {
    background: var(--accent-gold);
    color: #000;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
}

/* Sort Menu */
.sort-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    min-width: 150px;
    margin-top: 5px;
    overflow: hidden;
    display: none;
}

.sort-option {
    padding: 8px 12px;
    font-size: 13px;
    color: var(--text-primary);
    cursor: pointer;
    transition: background 0.2s;
}

.sort-option:hover {
    background: var(--card-hover);
}

.sort-option.active {
    background: rgba(197, 160, 101, 0.1);
    color: var(--accent-gold);
    font-weight: 500;
}

.earthquake-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 5px;
}

/* Global Scrollbar */
*::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

*::-webkit-scrollbar-track {
    background: transparent;
}

*::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

*::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Cards (Flat Style) */
.quake-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    /* Added border for better separation in light mode */
    border-left: 3px solid transparent;
    border-radius: 4px;
    /* Sharper corners */
    padding: 16px;
    margin-bottom: 10px;
    transition: background-color 0.2s, border-color 0.2s;
    cursor: pointer;
}

.quake-card:hover {
    background-color: var(--card-hover);
}

.card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    align-items: center;
}

.source-badge {
    font-size: 10px;
    background: var(--bg-dark);
    /* Provide contrast in both modes */
    padding: 2px 6px;
    border-radius: 3px;
    color: var(--text-secondary);
}

/* Utility for Truncation */
.text-truncate {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.mag-badge {
    padding: 3px 8px;
    border-radius: 6px;
    border-radius: 4px;
    color: #fff;
    font-weight: 600;
    font-size: 13px;
}

/* Magnitude Colors (Solid) */
.mag-severe {
    background-color: #8E44AD;
}

.mag-high {
    background-color: var(--accent-red);
}

.mag-mid {
    background-color: #F39C12;
    color: #fff;
}

.mag-low {
    background-color: #27AE60;
}

.card-location {
    color: var(--text-primary);
    font-size: 14px;
    margin-bottom: 8px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.card-stats {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-tertiary);
    border-top: 1px solid var(--border-color);
    padding-top: 8px;
    margin-top: 8px;
}

/* Map */
.main-content {
    flex: 1;
    position: relative;
    background: #111;
}

#map {
    height: 100%;
    width: 100%;
    background: var(--bg-dark);
    transition: background-color 0.3s ease;
}

[data-theme="light"] .leaflet-tile-pane {
    filter: brightness(0.9) contrast(1.1);
    /* Slightly darken and increase contrast */
}

/* Leaflet Popup Flat */
.leaflet-popup-content-wrapper,
.leaflet-popup-tip {
    background: var(--bg-sidebar) !important;
    color: var(--text-primary) !important;
    border-radius: 6px !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5) !important;
}

/* Tablet / Intermediate Desktop: Auto-Collapse to Rail Mode (Handled via JS now) */
@media (min-width: 769px) and (max-width: 1200px) {
    /* 
       We removed the forced .sidebar width and element hiding here.
       JS will add .rail-mode class which triggers the same styles 
       defined in .sidebar.rail-mode 
    */

    .sidebar.rail-mode .main-nav li {
        justify-content: center;
        padding: 15px 0;
    }

    .sidebar .main-nav .icon {
        font-size: 24px;
        margin: 0;
    }

    /* Removed display:none!important for toggle to allow user interaction */
    /* Removed padding/centering overrides that relied on hidden toggle */

    /* We can keep the logo alignment if rail mode is active, but since
       toggle is back, we might want standard layout or adapted one.
       Let's trust the .rail-mode class styles to handle the layout. */

    /* If logo has text, hide it or style it? */
    /* Assuming rail mode usually shows just an icon or truncated text.
       If h1 text is hidden by previous rule, we might need to ensure the container doesn't collapse weirdly. */
}

/* Mobile Optimization */
@media (max-width: 768px) {
    .dashboard-container {
        flex-direction: column;
    }

    .main-content {
        order: 1;
        height: 25vh;
        /* Map takes top 25% */
        width: 100%;
    }

    .sidebar {
        order: 2;
        width: 100% !important;
        height: 75vh;
        /* List takes bottom 75% */
        min-width: 0 !important;
        max-width: none !important;
        border-right: none;
        border-top: 1px solid var(--border-color);
        transition: height 0.3s ease;
        padding: 10px 15px;
        /* Safe Area for Mobile Home Indicator */
        padding-bottom: env(safe-area-inset-bottom, 20px);
    }

    /* Horizontal Nav Logic - ALWAYS on Mobile */
    .sidebar .main-nav ul {
        display: flex;
        flex-direction: row;
        gap: 8px;
        margin-bottom: 10px;
        padding-bottom: 0;
        border-bottom: none;
        overflow-x: auto;
        /* In case of small screens */
    }

    .sidebar .main-nav li {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-align: center;
        padding: 8px 6px;
        margin-bottom: 0;
        font-size: 13px;
        white-space: nowrap;
        background: var(--bg-sidebar);
        border: 1px solid var(--border-color);
        border-radius: 6px;
    }

    /* Reset Icon styles for mobile to ensure alignment */
    .sidebar .main-nav .icon {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        padding: 0;
        width: auto;
        height: auto;
    }

    .sidebar .main-nav .icon svg {
        width: 16px;
        height: 16px;
        display: block;
        /* Removes SVG descender space */
    }

    /* Active State Adjustment */
    .sidebar .main-nav li.active {
        background: var(--accent-gold);
        color: #000;
        border-color: var(--accent-gold);
    }

    /* Small Mobile: Icon Only Mode (< 450px) */
    @media (max-width: 450px) {
        .sidebar .main-nav li span:not(.icon) {
            display: none;
            /* Hide text */
        }

        .sidebar .main-nav li {
            padding: 10px;
            /* Increase padding for touch target */
        }

        .sidebar .main-nav .icon svg {
            width: 20px;
            /* Larger icons */
            height: 20px;
        }
    }

    .sidebar .logo-area {
        margin-bottom: 5px;
        padding-bottom: 5px;
        border-bottom: none;
        /* Often cleaner on mobile */
    }

    .sidebar .logo-area h1 {
        font-size: 16px;
    }


    /* Rail Mode on Mobile = Minimized Bottom Bar */
    .sidebar.rail-mode {
        width: 100% !important;
        min-width: 0 !important;
        height: 80px !important;
        /* Contextual header only */
        padding: 10px 20px;
        overflow: hidden;
    }

    /* Adjust content visibility in Rail Mode (Mobile) */
    .sidebar.rail-mode .earthquake-list-container {
        display: none;
    }

    .sidebar.rail-mode .logo-area {
        display: flex !important;
        /* Keep header visible */
        justify-content: space-between !important;
        margin-bottom: 0;
        padding-bottom: 0;
        border: none;
    }

    /* Hide nav in rail mode on mobile to save space, or show horizontal? 
       Let's show horizontal nav in rail mode */
    .sidebar.rail-mode .main-nav {
        display: none;
        /* Simplest: Hide nav, show only header/toggle */
    }

    /* Hide Toggle Button on Mobile */
    #sidebar-toggle-btn {
        display: none !important;
    }

    /* Resizer useless on mobile vertical */
    #sidebar-resizer {
        display: block;
        width: 100%;
        height: 30px;
        /* Grabbable area - increased */
        top: -15px;
        /* Position slightly above to overlap border */
        left: 0;
        bottom: auto;
        right: auto;
        cursor: row-resize;
        /* Visual indicator */
        background: transparent;
        z-index: 1005;
    }

    #sidebar-resizer::after {
        content: "";
        display: block;
        width: 50px;
        height: 5px;
        background: #444;
        border-radius: 3px;
        margin: 12px auto 4px auto;
    }

    /* Mobile Toggle Icon */
    .mobile-toggle-icon {
        display: none;
        font-size: 16px;
        color: #C5A065;
        cursor: pointer;
        user-select: none;
        line-height: 1;
        vertical-align: middle;
    }

    @media (max-width: 768px) {
        .mobile-toggle-icon {
            display: inline-block;
        }

        .mobile-toggle-icon::before {
            content: "▼";
        }

        .sidebar.minimized .mobile-toggle-icon::before {
            content: "▲";
        }
    }

    /* Hide navigation in minimized state */
    .sidebar.minimized .main-nav {
        display: none !important;
    }
}